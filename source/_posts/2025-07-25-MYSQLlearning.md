---
title: MYSQL learning
date: 2025-07-25 15:46:07
tags: MYSQL learning
urlname: MYSQL learning
categories: MYSQL learning
updated: 2025-07-25 21:26:16
---

## MySQL基础

### MySQL介绍

1. 关系型数据库(**有行有列**) **SQLite(进程内的db)**  NOSQL(**非关系数据库)键值对**（key-value）:redis leveldb rocksdb 大数据分析列式数据库 Hbase
2. 大家熟悉的关系型数据库还有SQL Server,Oracle,MySQL,MariaDB,DB2
3. MySQL区别于其他关系型数据库最大的一个特点就是**支持插件式的存储引擎**，支持如**InnoDB,MyISAM,Memory**等
4. MySQL设计成**C/S模型**
5. MySQL的服务器模型采用的是**I/O复用+可伸缩的线程池**，是实现网络服务器的经典模型。用的是**select+线程池。**这里为什么不设计成epoll+线程池，或者更高效的模型，**用select,因为网络I/O快，但是MySQL还需要把数据存储到磁盘，磁盘I/O速度是比较慢的，所以速度匹配即可，没必要做那么快**。

![1](1.png)

**Windows下MySQL安装目录中有一个my.ini文件，可以做一些配置调优。在data文件夹中，每建立一个数据库会有一个文件夹与其对应。**

**Linux下mysql的配置文件 /etc/my.cnf，没有可以自己创建**

```bash
#在root用户下
netstat -tanp #查看mysql是否启动,这个命令主要显示当前系统的所有 TCP 连接及其状态，并显示对应的进程信息。
service mysql start #启动mysql
```

### MySQL数据类型

**MySQL数据类型定义了数据的大小范围，因此使用时选择合适的类型，不仅会降低表占用的磁盘空间，间接减少了磁盘I/O的次数，提高了表的访问效率，而且索引的效率也和数据的类型息息相关。**

#### **整数类型（Integer Types）**

| 类型               | 大小（字节） | 范围（有符号）                                          | 范围（无符号）                  | 描述           |
| ------------------ | ------------ | ------------------------------------------------------- | ------------------------------- | -------------- |
| `TINYINT`          | 1            | -128 到 127                                             | 0 到 255                        | 很小的整数     |
| `SMALLINT`         | 2            | -32,768 到 32,767                                       | 0 到 65,535                     | 小整数         |
| `MEDIUMINT`        | 3            | -8,388,608 到 8,388,607                                 | 0 到 16,777,215                 | 中等大小的整数 |
| `INT` 或 `INTEGER` | 4            | -2,147,483,648 到 2,147,483,647                         | 0 到 4,294,967,295              | 常用整数类型   |
| `BIGINT`           | 8            | -9,223,372,036,854,775,808 到 9,223,372,036,854,775,807 | 0 到 18,446,744,073,709,551,615 | 大整数         |

可加上 `UNSIGNED` 修饰符来存储更大的非负整数

age INT(9)：整型占用内存的大小是固定的，和具体的类型是强相关的。(M)只是代表整数显示的宽度

####  **浮点与定点类型（Floating-Point and Fixed-Point Types）**

**推荐DECIMAL,FLOAT和DOUBLE数据越界不会报错，DECIMAL会报错**

| 类型                             | 描述         | 范围和精度                                      |
| -------------------------------- | ------------ | ----------------------------------------------- |
| `FLOAT(M,D)`                     | 单精度浮点数 | 近似值，4字节，M是总位数，D是小数位数 7位精度   |
| `DOUBLE(M,D)` 或 `REAL(M,D)`     | 双精度浮点数 | 近似值，8字节，M是总位数，D是小数位数  15位精度 |
| `DECIMAL(M,D)` 或 `NUMERIC(M,D)` | 定点数       | 精确值，适合存储货币等对精度要求高的场景        |

- `M`: 精度（总位数），`D`: 小数位数
- `DECIMAL` 使用字符串进行存储，防止浮点误差
- 如果 `M` 和 `D` 不指定，MySQL 默认为 `DECIMAL(10,0)`

#### **字符型类型**

| 类型         | 最大长度                              | 是否定长 | 是否可设默认值 | 特点说明                            | 典型用途                 |
| ------------ | ------------------------------------- | -------- | -------------- | ----------------------------------- | ------------------------ |
| `CHAR(M)`    | 最多 255 字符                         | ✅        | ✅              | 固定长度，右侧自动补空格            | 固定长度：手机号、身份证 |
| `VARCHAR(M)` | 取决于字符集（如 utf8mb4 最多 21844） | ❌        | ✅              | 变长字符串，节省空间，需额外1-2字节 | 姓名、标题、备注         |
| `TINYTEXT`   | 255 字节                              | ❌        | ❌              | 极短文本，不能设默认值              | 简短评论、小段文字       |
| `TEXT`       | 64 KB                                 | ❌        | ❌              | 常用文本类型，不能设默认值          | 文章正文、用户简介       |
| `MEDIUMTEXT` | 16 MB                                 | ❌        | ❌              | 中大型文本                          | 博文、报告内容           |
| `LONGTEXT`   | 4 GB                                  | ❌        | ❌              | 超大文本                            | 大文档、日志             |

| 类型           | 最大长度        | 特点说明                             | 用途举例               |
| -------------- | --------------- | ------------------------------------ | ---------------------- |
| `BINARY(M)`    | 最多 255 字节   | 类似 `CHAR`，存储二进制数据，定长    | 加密哈希、固定密钥存储 |
| `VARBINARY(M)` | 最多 65535 字节 | 类似 `VARCHAR`，变长二进制字符串     | 二进制令牌、签名       |
| `TINYBLOB`     | 255 字节        | 与 `TINYTEXT` 类似，但用于二进制数据 | 小图标、缩略图         |
| `BLOB`         | 64 KB           | 与 `TEXT` 类似，用于二进制内容       | 图像、音频、文件       |
| `MEDIUMBLOB`   | 16 MB           | 中等大小二进制对象                   | 视频、音频中等资源     |
| `LONGBLOB`     | 4 GB            | 超大二进制对象                       | 文件存储、大附件       |

#### **日期和时间类型**

| 类型        | 占用空间 | 范围/格式                                          | 精度   | 用途示例           |
| ----------- | -------- | -------------------------------------------------- | ------ | ------------------ |
| `DATE`      | 3 字节   | `1000-01-01` 到 `9999-12-31`                       | 到“日” | 出生日期、订单日期 |
| `TIME`      | 3 字节   | `-838:59:59` 到 `838:59:59`                        | 到“秒” | 持续时间、工时     |
| `DATETIME`  | 8 字节   | `1000-01-01 00:00:00` 到 `9999-12-31 23:59:59`     | 到“秒” | 记录某一精确时刻   |
| `TIMESTAMP` | 4 字节   | `1970-01-01 00:00:01` UTC 到 `2038-01-19 03:14:07` | 到“秒” | 创建时间、修改时间 |
| `YEAR`      | 1 字节   | `1901` 到 `2155`                                   | 到“年” | 出厂年份、学年     |

#### 枚举与集合类型（可存储预定义字符串）

| 类型        | 特点说明                                                | 示例用途                                      |
| ----------- | ------------------------------------------------------- | --------------------------------------------- |
| `ENUM(...)` | 从固定字符串列表中选一个值，实际存储为整数索引（1字节） | 性别、状态（如 `'男','女'`、`'启用','禁用'`） |
| `SET(...)`  | 可多选，存储为位图（1~8字节），最多支持 64 个选项       | 标签、用户权限、兴趣爱好                      |

### MySQL运算符

#### 算数运算符

| 运算符 | 含义         | 示例                 | 结果  |
| ------ | ------------ | -------------------- | ----- |
| `+`    | 加法         | `5 + 3`              | `8`   |
| `-`    | 减法         | `5 - 3`              | `2`   |
| `*`    | 乘法         | `5 * 3`              | `15`  |
| `/`    | 除法         | `5 / 2`              | `2.5` |
| `DIV`  | 整除         | `5 DIV 2`            | `2`   |
| `%`    | 取模（余数） | `5 % 2` 或 `5 MOD 2` | `1`   |
| `MOD`  | 同 `%`       | `5 MOD 3`            | `2`   |

#### 逻辑运算符

| 运算符 | 名称            | 示例                        | 说明                           |
| ------ | --------------- | --------------------------- | ------------------------------ |
| `AND`  | 逻辑与          | `age > 18 AND gender = 'M'` | 两个条件都为真，结果才为真     |
| `OR`   | 逻辑或          | `score > 90 OR grade = 'A'` | 至少一个条件为真，结果为真     |
| `NOT`  | 逻辑非          | `NOT (age < 18)`            | 取反，原来为真变为假，反之亦然 |
| `XOR`  | 逻辑异或        | `TRUE XOR FALSE`            | 仅当两个值不同，结果才为真     |
| `!`    | 逻辑非（简写）  | `!is_deleted`               | 等价于 `NOT is_deleted`        |
| `&&`   | 与（MySQL兼容） | `a > 5 && b < 10`           | 等价于 `AND`                   |
| `||`   | 逻辑或          |                             |                                |

#### 比较运算符

| 运算符                    | 含义                  | 示例                              | 结果                      |
| ------------------------- | --------------------- | --------------------------------- | ------------------------- |
| `=`                       | 等于                  | `age = 18`                        | `true` 或 `false`         |
| `!=` 或 `<>`              | 不等于                | `name != 'Tom'`                   | `true` 或 `false`         |
| `>`                       | 大于                  | `score > 60`                      | `true` 或 `false`         |
| `<`                       | 小于                  | `score < 60`                      | `true` 或 `false`         |
| `>=`                      | 大于等于              | `score >= 90`                     | `true` 或 `false`         |
| `<=`                      | 小于等于              | `score <= 100`                    | `true` 或 `false`         |
| `<=>`                     | 安全等于（支持 NULL） | `a <=> NULL`                      | `true` if both NULL       |
| `IS NULL`                 | 判断是否为 NULL       | `birthday IS NULL`                | `true` 或 `false`         |
| `IS NOT NULL`             | 非 NULL               | `email IS NOT NULL`               | `true` 或 `false`         |
| `BETWEEN ... AND ...`     | 在区间内              | `score BETWEEN 60 AND 90`         | 含头尾：`60 ≤ score ≤ 90` |
| `NOT BETWEEN ... AND ...` | 不在区间              | `age NOT BETWEEN 18 AND 25`       | `true` 或 `false`         |
| `IN (...)`                | 属于集合              | `city IN ('Beijing', 'Shanghai')` | 是否存在于集合中          |
| `NOT IN (...)`            | 不属于集合            | `status NOT IN ('A', 'B')`        | `true` 或 `false`         |
| `LIKE`                    | 模糊匹配（单行）      | `name LIKE 'J%'`                  | `J`开头的字符串           |
| `NOT LIKE`                | 非匹配                | `email NOT LIKE '%.com'`          | 不以`.com`结尾            |
| `REGEXP` 或 `RLIKE`       | 正则匹配              | `name REGEXP '^A.*'`              | 匹配正则表达式            |

### MySQL常用函数

| 分类         | 函数名                                | 功能描述                        | 示例                                             | 示例结果                |
| ------------ | ------------------------------------- | ------------------------------- | ------------------------------------------------ | ----------------------- |
| 字符串函数   | `CONCAT(str1, str2, ...)`             | 字符串连接                      | `CONCAT('Hello', 'World')`                       | `'HelloWorld'`          |
|              | `LENGTH(str)`                         | 字节长度（utf8中一个汉字3字节） | `LENGTH('abc')`                                  | `3`                     |
|              | `CHAR_LENGTH(str)`                    | 字符长度（汉字算1个字符）       | `CHAR_LENGTH('你好')`                            | `2`                     |
|              | `UPPER(str)`                          | 转大写                          | `UPPER('abc')`                                   | `'ABC'`                 |
|              | `LOWER(str)`                          | 转小写                          | `LOWER('ABC')`                                   | `'abc'`                 |
|              | `REPLACE(str, from_str, to_str)`      | 字符串替换                      | `REPLACE('abcabc', 'a', 'x')`                    | `'xbcxbc'`              |
|              | `SUBSTRING(str, pos, len)`            | 截取字符串                      | `SUBSTRING('abcdef', 2, 3)`                      | `'bcd'`                 |
|              | `TRIM(str)`                           | 去除字符串首尾空格              | `TRIM('  abc ')`                                 | `'abc'`                 |
| 数值函数     | `ABS(n)`                              | 绝对值                          | `ABS(-10)`                                       | `10`                    |
|              | `ROUND(n, d)`                         | 四舍五入到小数点后 d 位         | `ROUND(3.14159, 2)`                              | `3.14`                  |
|              | `CEIL(n)`                             | 向上取整                        | `CEIL(2.3)`                                      | `3`                     |
|              | `FLOOR(n)`                            | 向下取整                        | `FLOOR(2.7)`                                     | `2`                     |
|              | `MOD(a, b)`                           | 取模                            | `MOD(10, 3)`                                     | `1`                     |
|              | `RAND()`                              | 生成0到1之间随机数              | `RAND()`                                         | `0.123456789`（示例）   |
|              | `TRUNCATE(n, d)`                      | 截断数字到小数点后 d 位         | `TRUNCATE(3.4567, 2)`                            | `3.45`                  |
| 日期时间函数 | `NOW()`                               | 当前日期时间                    | `NOW()`                                          | `'2025-07-25 20:30:00'` |
|              | `CURDATE()`                           | 当前日期                        | `CURDATE()`                                      | `'2025-07-25'`          |
|              | `CURTIME()`                           | 当前时间                        | `CURTIME()`                                      | `'20:30:00'`            |
|              | `DATE_FORMAT(date, fmt)`              | 格式化日期                      | `DATE_FORMAT(NOW(), '%Y-%m-%d')`                 | `'2025-07-25'`          |
|              | `DATEDIFF(a, b)`                      | 计算日期差（a - b）天数         | `DATEDIFF('2025-08-01', '2025-07-25')`           | `7`                     |
|              | `TIMESTAMPDIFF(unit, a, b)`           | 计算两时间差，单位可选          | `TIMESTAMPDIFF(DAY, '2025-07-25', '2025-08-01')` | `7`                     |
|              | `ADDDATE(date, n)`                    | 日期加n天                       | `ADDDATE('2025-07-25', 5)`                       | `'2025-07-30'`          |
|              | `SUBDATE(date, n)`                    | 日期减n天                       | `SUBDATE('2025-07-25', 5)`                       | `'2025-07-20'`          |
| 聚合函数     | `COUNT(*)`                            | 统计行数                        | `SELECT COUNT(*) FROM users`                     | `100`                   |
|              | `SUM(col)`                            | 求和                            | `SUM(price)`                                     | `12345.67`              |
|              | `AVG(col)`                            | 平均值                          | `AVG(score)`                                     | `87.5`                  |
|              | `MAX(col)`                            | 最大值                          | `MAX(age)`                                       | `60`                    |
|              | `MIN(col)`                            | 最小值                          | `MIN(created_at)`                                | `'2020-01-01'`          |
| 条件判断函数 | `IF(expr, a, b)`                      | 条件判断，类似三元运算符        | `IF(score > 60, '及格', '不及格')`               | `'及格'`                |
|              | `IFNULL(expr, val)`                   | 如果 expr 为 NULL，返回 val     | `IFNULL(name, '未知')`                           | `'未知'`                |
|              | `NULLIF(a, b)`                        | 若 a = b，则返回 NULL，否则 a   | `NULLIF(1,1)` → `NULL`                           | `NULL`                  |
|              | `CASE WHEN ... THEN ... ELSE ... END` | 多条件判断                      | 参见下方示例                                     |                         |

### MySQL完整性约束

#### 主键约束

**primary key**(**唯一且不为空**)

#### 自增键约束

**auto_increment(整型自增)**

#### 唯一键约束

**unique(不可以重复但是可以为空)**

#### 非空约束

**not null**

#### 默认值约束

**default**

#### 外键约束

**foreign key** 

```mysql
CREATE TABLE USER(
id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '用户的主键id',
nickname varchar(50) UNIQUE NOT NULL COMMENT '用户的昵称',
age TINYINT UNSIGNED NOT NULL DEFAULT 18,
sex ENUM('male','female'));
```

```mysql
+----------+-----------------------+------+-----+---------+----------------+
| Field    | Type                  | Null | Key | Default | Extra          |
+----------+-----------------------+------+-----+---------+----------------+
| id       | int unsigned          | NO   | PRI | NULL    | auto_increment |
| nickname | varchar(50)           | NO   | UNI | NULL    |                |
| age      | tinyint unsigned      | NO   |     | 18      |                |
| sex      | enum('male','female') | YES  |     | NULL    |                |
+----------+-----------------------+------+-----+---------+----------------+
4 rows in set (0.03 sec)
```

### 关系型数据库表设计

#### 一对一

#### 一对多

#### 多对多